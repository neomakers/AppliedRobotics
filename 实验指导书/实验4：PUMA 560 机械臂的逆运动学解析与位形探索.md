# 实验四：PUMA 560 机械臂的逆运动学解析与位形探索

## 一、实验目的

1. 理解位形标志：通过对PUMA 560机械臂的实验，使学生了解和应用位形标志，以判断不同运动状态下的机械臂姿态。
2. 探索奇异性问题：理解逆运动学中的奇异性问题，学习如何通过调整位形标志来避免运动中的奇异性现象。
3. 实现复杂加工轨迹：通过设置特定的加工轨迹，学习如何规划和执行复杂的机械臂运动，并进行仿真。

## 二、实验设备

1. Python 3.7及以上版本
2. `NumPy`、`Matplotlib`、`SymPy`、`Robotics Toolbox for Python`
   
安装所需库：
```bash
pip install numpy matplotlib sympy roboticstoolbox-python
```

## 三、实验原理及说明

PUMA 560是一款典型的6自由度关节式机械臂。其逆运动学问题具有多种解法，具体姿态由以下三种配置来决定：
1. **左手(L)或右手(R)**：描述机械臂相对于基座的整体方向；
2. **肘部在上(U)或在下(D)**：描述机械臂的肘关节是向上弯曲还是向下；
3. **腕关节翻转(Flip)或不翻转(No flip)**：描述腕关节是否进行了翻转。

结合这些状态，PUMA 560机械臂的逆运动学有多种解法，这些解法可以通过调整位形标志来选择合适的路径。

## 四、实验内容及步骤

### 步骤1：PUMA 560不同位姿实验

#### 任务

通过对PUMA 560机械臂的仿真，实验各种位形标志的组合对逆运动学解的影响。

#### 实验代码

```python
import numpy as np
import roboticstoolbox as rtb
import matplotlib.pyplot as plt
from spatialmath import SE3

# 加载PUMA 560机械臂模型
puma = rtb.models.DH.Puma560()

# 定义目标位姿（末端位置和姿态）
T_target = SE3(0.5, 0.3, 0.44) * SE3.Ry(np.pi / 2)

# 计算右手-肘部向上的解
q_ru = puma.ikine(T_target)

# 绘制机械臂在该位形下的姿态
puma.plot(q_ru.q, block=True)

print("右手-肘部向上位形下的关节角度：", q_ru.q)

# 计算左手-肘部向下的解
q_ld = puma.ikine(T_target, 'ld')

# 绘制机械臂在左手-肘部向下的位形
puma.plot(q_ld.q, block=True)

print("左手-肘部向下位形下的关节角度：", q_ld.q)
```

#### 结果分析

1. **右手-肘部向上（RU）**：这是PUMA 560机械臂的默认配置，肘部弯曲向上，腕部未翻转。
2. **左手-肘部向下（LD）**：通过指定不同的位形标志，机械臂的肘部和手臂方向会产生显著变化。

学生可以观察到在不同位形标志下，机械臂到达同一目标位置的姿态差异。

### 步骤2：调整位形标志以改善奇异现象

#### 任务

探索PUMA 560机械臂的奇异现象，并通过调整位形标志来改善机械臂的运动连续性。

#### 实验代码

```python
# 定义两个目标位置和姿态的变换矩阵
T1 = SE3(0.5, 0.3, 0.44) * SE3.Ry(np.pi / 2)
T2 = SE3(0.5, -0.3, 0.44) * SE3.Ry(np.pi / 2)

# 生成轨迹
traj = rtb.jtraj(T1, T2, 50)

# 计算PUMA 560机械臂的逆运动学解，并绘制运动轨迹
q_ur = puma.ikine(traj.q[0], 'ur')  # 设置位形标志为右手-肘部向上-腕部翻转
puma.plot(q_ur.q, block=True)
```

#### 结果分析

1. **奇异性问题**：在PUMA 560的某些姿态下，机械臂的关节可能出现奇异现象，导致运动的不连续或不稳定。
2. **解决方案**：通过调整位形标志，如右手-肘部向上-腕部翻转（UR），可以消除奇异性并保证机械臂的运动平滑。

### 步骤3：规划复杂加工轨迹

#### 任务

通过逆运动学，规划并仿真PUMA 560机械臂沿复杂加工轨迹的运动。

#### 实验代码

```python
# 定义一个加工轨迹的路径点
path = np.array([
    [1, 0, 1], [1, 0, 0], [0, 0, 0], [0, 2, 0], [1, 2, 0],
    [1, 2, 1], [0, 1, 1], [0, 1, 0], [1, 1, 0], [1, 1, 1]
])

# 生成轨迹
traj = rtb.mstraj(path, dt=0.05, tacc=0.2, qdmax=1.0)

# 逆运动学求解
q = puma.ikine(traj.q)

# 绘制机械臂沿轨迹的运动
puma.plot(q.q, block=True)
```

#### 结果分析

1. **加工轨迹**：通过定义多个关键点，机械臂沿加工路径平滑运动。
2. **轨迹仿真**：机械臂的末端执行器在加工路径上移动，模拟了实际工业生产中的运动过程。

## 五、思考与讨论

1. **位形标志的作用**：在机械臂的控制中，位形标志影响机械臂的逆运动学解的选择。通过不同的标志组合，可以得到不同的姿态配置。
2. **奇异性现象及其避免**：在实际应用中，机械臂的奇异性会导致关节的突然变化，可能导致控制失稳。通过调整位形标志，可以有效避免奇异性。
3. **复杂轨迹规划的挑战**：在实际规划加工轨迹时，需要考虑机械臂的工作空间、关节极限和避免奇异现象的策略。
